Resolving worker runtime to 'node'.
'local.settings.json' found in root directory (/root/app/code/api).


Azure Functions Core Tools
Core Tools Version:       4.6.0+ab90faafcab539d63cd3d0ce5faf1bca4395fccc (64-bit)
Function Runtime Version: 4.1045.200.25556

[2026-01-10T05:33:34.746Z] Node.js v20 will reach EOL on 2026-04. Consider upgrading: https://aka.ms/functions-nodejs-supported-versions
[2026-01-10T05:33:35.300Z] [api/index.js] Starting handler registration...
[2026-01-10T05:33:35.300Z] [api] Registering: health
[2026-01-10T05:33:35.300Z] [api] Registering: ping
[2026-01-10T05:33:35.300Z] [api] ✓ ping registered
[2026-01-10T05:33:35.300Z] [api] Registering: version
[2026-01-10T05:33:35.300Z] [api] ✓ version registered
[2026-01-10T05:33:35.300Z] [api] Registering: diag
[2026-01-10T05:33:35.301Z] [api] ✓ diag registered
[2026-01-10T05:33:35.301Z] [api] Registering: _diag-hello
[2026-01-10T05:33:35.301Z] [api] ✓ _diag-hello registered
[2026-01-10T05:33:35.301Z] [api] Registering: hello
[2026-01-10T05:33:35.301Z] [api] Registering: proxy-xai
[2026-01-10T05:33:35.301Z] [api] Registering: v1-chat-completions
[2026-01-10T05:33:35.301Z] [api] Registering: _debug-ingress-latest
[2026-01-10T05:33:35.301Z] [api] Registering: _debug-egress-latest
[2026-01-10T05:33:35.301Z] [api] Registering: submit-review
[2026-01-10T05:33:35.301Z] [api] Registering: get-reviews
[2026-01-10T05:33:35.301Z] [api] Registering: xadmin-api-recalc-review-counts
[2026-01-10T05:33:35.301Z] [api] Registering: search-companies
[2026-01-10T05:33:35.301Z] [api] Registering: suggest-refinements
[2026-01-10T05:33:35.301Z] [api] ✓ suggest-refinements registered
[2026-01-10T05:33:35.301Z] [api] Registering: suggest-cities
[2026-01-10T05:33:35.301Z] [api] ✓ suggest-cities registered
[2026-01-10T05:33:35.301Z] [api] Registering: suggest-states
[2026-01-10T05:33:35.301Z] [api] ✓ suggest-states registered
[2026-01-10T05:33:35.301Z] [api] Registering: save-companies
[2026-01-10T05:33:35.301Z] [api] Registering: logo-scrape
[2026-01-10T05:33:35.301Z] [api] Registering: cosmos-smoke
[2026-01-10T05:33:35.301Z] [api] Registering: import-start
[2026-01-10T05:33:35.301Z] [import-start] module_loaded {
[2026-01-10T05:33:35.301Z]   handler_version: 'ded-import-start-2b8de4368648',
[2026-01-10T05:33:35.302Z]   build_id: '2b8de4368648dfe08a4b13d2aa5431bc2c8f37af'
[2026-01-10T05:33:35.302Z] }
[2026-01-10T05:33:35.302Z] [api] Registering: import-backend-ping
[2026-01-10T05:33:35.302Z] [api] Registering: import-status
[2026-01-10T05:33:35.302Z] [api] Registering: import-progress
[2026-01-10T05:33:35.302Z] [api] Registering: import-stop
[2026-01-10T05:33:35.302Z] [api] Registering: import/primary-worker
[2026-01-10T05:33:35.302Z] [api] Registering: google/geocode
[2026-01-10T05:33:35.302Z] [api] Registering: google/translate
[2026-01-10T05:33:35.302Z] [api] Registering: test-echo
[2026-01-10T05:33:35.302Z] [test-echo] Module loaded
[2026-01-10T05:33:35.302Z] [test-echo] Handler registered successfully
[2026-01-10T05:33:35.302Z] [api] ✓ test-echo registered
[2026-01-10T05:33:35.302Z] [api] Registering: companies-list
[2026-01-10T05:33:35.302Z] [companies-list] Starting module load...
[2026-01-10T05:33:35.302Z] [companies-list] @azure/functions imported, app object created
[2026-01-10T05:33:35.302Z] [companies-list] About to register app.http handler...
[2026-01-10T05:33:35.302Z] [companies-list] ✅ Handler registered successfully with app.http v2
[2026-01-10T05:33:35.302Z] [api] ✓ companies-list registered
[2026-01-10T05:33:35.302Z] [api] Registering: keywords-list
[2026-01-10T05:33:35.302Z] [keywords-list] Module loading started
[2026-01-10T05:33:35.302Z] [keywords-list] Registering with app.http...
[2026-01-10T05:33:35.302Z] [keywords-list] ✅ Successfully registered app.http with route: keywords-list
[2026-01-10T05:33:35.302Z] [api] ✓ keywords-list registered
[2026-01-10T05:33:35.302Z] [api] Registering: upload-logo-blob
[2026-01-10T05:33:35.302Z] [api] ✓ upload-logo-blob registered
[2026-01-10T05:33:35.303Z] [api] Registering: delete-logo-blob
[2026-01-10T05:33:35.303Z] [api] ✓ delete-logo-blob registered
[2026-01-10T05:33:35.303Z] [api] Registering: company-logo
[2026-01-10T05:33:35.303Z] [api] ✓ company-logo registered
[2026-01-10T05:33:35.303Z] [api] Registering: xadmin-api-logos
[2026-01-10T05:33:35.303Z] [api] ✓ xadmin-api-logos registered
[2026-01-10T05:33:35.303Z] [api] Registering: retry-logo-import
[2026-01-10T05:33:35.303Z] [api] ✓ retry-logo-import registered
[2026-01-10T05:33:35.303Z] [api] Registering: admin-keywords
[2026-01-10T05:33:35.303Z] [api] ❌ Failed to load admin-keywords: Identifier 'app' has already been declared
[2026-01-10T05:33:35.303Z] [api] Registering: admin-analytics
[2026-01-10T05:33:35.303Z] [api] ✓ admin-analytics registered
[2026-01-10T05:33:35.303Z] [api] Registering: admin-batch-update
[2026-01-10T05:33:35.303Z] [api] ✓ admin-batch-update registered
[2026-01-10T05:33:35.303Z] [api] Registering: admin-bulk-import-config
[2026-01-10T05:33:35.303Z] [api] ✓ admin-bulk-import-config registered
[2026-01-10T05:33:35.303Z] [api] Registering: admin-companies-v2
[2026-01-10T05:33:35.303Z] [api] ✓ admin-companies-v2 registered
[2026-01-10T05:33:35.303Z] [api] Registering: admin-company-history
[2026-01-10T05:33:35.303Z] [api] ✓ admin-company-history registered
[2026-01-10T05:33:35.304Z] [api] Registering: xadmin-api-debug
[2026-01-10T05:33:35.304Z] [api] ✓ xadmin-api-debug registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-echo
[2026-01-10T05:33:35.304Z] [api] ✓ admin-echo registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-import-stats
[2026-01-10T05:33:35.304Z] [api] ✓ admin-import-stats registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-cleanup-import-placeholders
[2026-01-10T05:33:35.304Z] [api] ✓ admin-cleanup-import-placeholders registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-login
[2026-01-10T05:33:35.304Z] [api] ❌ Failed to load admin-login: Cannot find module 'bcryptjs'
[2026-01-10T05:33:35.304Z] Require stack:
[2026-01-10T05:33:35.304Z] - /root/app/code/api/admin-login/index.js
[2026-01-10T05:33:35.304Z] - /root/app/code/api/index.js
[2026-01-10T05:33:35.304Z] - /root/.npm/_npx/ea74a7a3cf090e3c/node_modules/azure-functions-core-tools/bin/workers/node/dist/src/worker-bundle.js
[2026-01-10T05:33:35.304Z] - /root/.npm/_npx/ea74a7a3cf090e3c/node_modules/azure-functions-core-tools/bin/workers/node/dist/src/nodejsWorker.js
[2026-01-10T05:33:35.304Z] [api] Registering: admin-notes
[2026-01-10T05:33:35.304Z] [api] ✓ admin-notes registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-recalc-stars
[2026-01-10T05:33:35.304Z] [api] ✓ admin-recalc-stars registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-reviews
[2026-01-10T05:33:35.304Z] [api] ✓ admin-reviews registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-save-diagnostic
[2026-01-10T05:33:35.304Z] [admin-save-diagnostic] ✅ Diagnostic endpoint registered
[2026-01-10T05:33:35.304Z] [api] ✓ admin-save-diagnostic registered
[2026-01-10T05:33:35.304Z] [api] Registering: admin-star-config
[2026-01-10T05:33:35.305Z] [api] ✓ admin-star-config registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-undo
[2026-01-10T05:33:35.305Z] [api] ✓ admin-undo registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-undo-history
[2026-01-10T05:33:35.305Z] [api] ✓ admin-undo-history registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-update-logos
[2026-01-10T05:33:35.305Z] [api] ✓ admin-update-logos registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-recent-imports
[2026-01-10T05:33:35.305Z] [api] ✓ admin-recent-imports registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-refresh-import
[2026-01-10T05:33:35.305Z] [api] ✓ admin-refresh-import registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-refresh-company
[2026-01-10T05:33:35.305Z] [api] ✓ admin-refresh-company registered
[2026-01-10T05:33:35.305Z] [api] Registering: xadmin-api-refresh-company
[2026-01-10T05:33:35.305Z] [api] ✓ xadmin-api-refresh-company registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-refresh-reviews
[2026-01-10T05:33:35.305Z] [api] ✓ admin-refresh-reviews registered
[2026-01-10T05:33:35.305Z] [api] Registering: xadmin-api-refresh-reviews
[2026-01-10T05:33:35.305Z] [api] ✓ xadmin-api-refresh-reviews registered
[2026-01-10T05:33:35.305Z] [api] Registering: admin-geocode-location
[2026-01-10T05:33:35.305Z] [api] ✓ admin-geocode-location registered
[2026-01-10T05:33:35.305Z] [api/index.js] ✅ All handler registration complete! Exporting app.
[2026-01-10T05:33:35.385Z] Worker process started and initialized.
[2026-01-10T05:33:35.533Z] The '_debug-ingress-latest' function is in error: '_debug-ingress-latest' is not a valid function name.
[2026-01-10T05:33:35.533Z] The '_diagHello' function is in error: '_diagHello' is not a valid function name.
[2026-01-10T05:33:35.533Z] The '_debug-egress-latest' function is in error: '_debug-egress-latest' is not a valid function name.
[2026-01-10T05:33:35.533Z] The 'admin-cleanup-import-placeholders' function is in error: The specified route conflicts with one or more built in routes.
[2026-01-10T05:33:35.533Z] The 'adminCompanyHistory' function is in error: The specified route conflicts with one or more built in routes.
[2026-01-10T05:33:35.533Z] The 'adminCompanyHistoryAlias' function is in error: The specified route conflicts with one or more built in routes.
[2026-01-10T05:33:35.534Z] The 'adminRefreshCompany' function is in error: The specified route conflicts with one or more built in routes.
[2026-01-10T05:33:35.534Z] The 'adminRefreshReviews' function is in error: The specified route conflicts with one or more built in routes.

Functions:

	adminAnalytics: [GET,OPTIONS] http://localhost:7076/api/xadmin-api-analytics

	adminBatchUpdate: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-batch-update

	adminBulkImportConfig: [GET,OPTIONS] http://localhost:7076/api/xadmin-api-bulk-import-config

	adminCompanies: [GET,POST,PUT,DELETE,OPTIONS] http://localhost:7076/api/xadmin-api-companies/{id?}

	adminDebug: [GET] http://localhost:7076/api/xadmin-api-debug

	adminEcho: [GET,OPTIONS] http://localhost:7076/api/xadmin-api-echo

	adminGeocodeLocation: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-geocode-location

	adminImportStats: [GET,OPTIONS] http://localhost:7076/api/xadmin-api-import-stats

	adminNotes: [GET,POST,PUT,DELETE,OPTIONS] http://localhost:7076/api/xadmin-api-notes

	adminRecalcStars: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-recalc-stars

	adminRecentImports: [GET,OPTIONS] http://localhost:7076/api/xadmin-api-recent-imports

	adminRefreshImport: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-refresh-import

	adminReviews: [GET,POST,PUT,DELETE,OPTIONS] http://localhost:7076/api/xadmin-api-reviews

	adminSaveDiagnostic: [GET,POST,OPTIONS] http://localhost:7076/api/xadmin-api-save-diagnostic

	adminStarConfig: [GET,PUT,OPTIONS] http://localhost:7076/api/xadmin-api-star-config

	adminUndo: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-undo

	adminUndoHistory: [GET,DELETE,OPTIONS] http://localhost:7076/api/xadmin-api-undo-history

	adminUpdateLogos: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-update-logos

	companies-list: [GET,POST,PUT,DELETE,OPTIONS] http://localhost:7076/api/companies-list

	company-logo: [GET,OPTIONS] http://localhost:7076/api/company-logo

	cosmos-smoke: [GET,OPTIONS] http://localhost:7076/api/cosmos/smoke

	delete-logo-blob: [POST,OPTIONS] http://localhost:7076/api/delete-logo-blob

	diag: [GET,OPTIONS] http://localhost:7076/api/diag

	get-reviews: [GET,OPTIONS] http://localhost:7076/api/get-reviews

	googleGeocode: [POST,OPTIONS] http://localhost:7076/api/google/geocode

	googleTranslate: [POST,OPTIONS] http://localhost:7076/api/google/translate

	health: [GET,OPTIONS] http://localhost:7076/api/health

	hello: [GET,OPTIONS] http://localhost:7076/api/hello

	import-backend-ping: [GET,OPTIONS] http://localhost:7076/api/import/backend-ping

	import-primary-worker: [POST,OPTIONS] http://localhost:7076/api/import/primary-worker

	import-progress: [GET,OPTIONS] http://localhost:7076/api/import/progress

	import-start: [GET,POST,OPTIONS] http://localhost:7076/api/import/start

	import-start-legacy: [GET,POST,OPTIONS] http://localhost:7076/api/import-start

	import-status: [GET,OPTIONS] http://localhost:7076/api/import/status

	import-status-alt: [GET,OPTIONS] http://localhost:7076/api/import-status

	import-stop: [POST,OPTIONS] http://localhost:7076/api/import/stop

	keywords-list: [GET,POST,PUT,DELETE,OPTIONS] http://localhost:7076/api/keywords-list

	logo-scrape: [POST,OPTIONS] http://localhost:7076/api/logo-scrape

	ping: [GET,OPTIONS] http://localhost:7076/api/ping

	proxy-xai: [GET,POST,OPTIONS] http://localhost:7076/api/proxy-xai

	retry-logo-import: [POST,OPTIONS] http://localhost:7076/api/retry-logo-import

	save-companies: [POST,OPTIONS] http://localhost:7076/api/save-companies

	search-companies: [GET,OPTIONS] http://localhost:7076/api/search-companies

	submit-review: [POST,OPTIONS] http://localhost:7076/api/submit-review

	suggest-cities: [GET,OPTIONS] http://localhost:7076/api/suggest-cities

	suggest-refinements: [GET,OPTIONS] http://localhost:7076/api/suggest-refinements

	suggest-states: [GET,OPTIONS] http://localhost:7076/api/suggest-states

	test-echo: [GET,POST,PUT,DELETE,OPTIONS] http://localhost:7076/api/test-echo

	upload-logo-blob: [POST,OPTIONS] http://localhost:7076/api/upload-logo-blob

	v1-chat-completions: [POST,OPTIONS] http://localhost:7076/api/v1/chat/completions

	version: [GET,OPTIONS] http://localhost:7076/api/version

	xadmin-api-logos: [PUT,OPTIONS] http://localhost:7076/api/xadmin-api-logos/{companyId}

	xadminApiRecalcReviewCounts: [POST,OPTIONS] http://localhost:7076/api/xadmin-api-recalc-review-counts

	xadminApiRefreshCompany: [GET,POST,OPTIONS] http://localhost:7076/api/xadmin-api-refresh-company

	xadminApiRefreshReviews: [GET,POST,OPTIONS] http://localhost:7076/api/xadmin-api-refresh-reviews

	xai-smoke: [GET,OPTIONS] http://localhost:7076/api/xai/smoke

For detailed output, run func with --verbose flag.
[2026-01-10T05:33:39.916Z] Executing 'Functions.ping' (Reason='This function was programmatically called via the host APIs.', Id=c80ff707-b185-4006-8ee3-ecc844a7bd7f)
[2026-01-10T05:33:39.998Z] Executed 'Functions.ping' (Succeeded, Id=c80ff707-b185-4006-8ee3-ecc844a7bd7f, Duration=104ms)
[2026-01-10T05:33:40.057Z] Executing 'Functions.import-start' (Reason='This function was programmatically called via the host APIs.', Id=a6eebca6-c63e-416e-b690-34d8a2ae38db)
[2026-01-10T05:33:40.070Z] [import-start] request_id=959a42f6-0450-4d1b-903e-465e2c1d147d Function handler invoked
[2026-01-10T05:33:40.071Z] [import-start] body_sources {
[2026-01-10T05:33:40.072Z]   hasRawBody: false,
[2026-01-10T05:33:40.072Z]   rawBodyType: 'undefined',
[2026-01-10T05:33:40.072Z]   rawBodyLen: 0,
[2026-01-10T05:33:40.072Z]   bodyType: 'ReadableStream',
[2026-01-10T05:33:40.072Z]   bodyLen: 0,
[2026-01-10T05:33:40.072Z]   hasBufferBody: false,
[2026-01-10T05:33:40.072Z]   bufferBodyLen: 0,
[2026-01-10T05:33:40.072Z]   isStreamBody: true
[2026-01-10T05:33:40.072Z] }
[2026-01-10T05:33:40.076Z] [import-start] request_id=959a42f6-0450-4d1b-903e-465e2c1d147d session=sess_1768023220073_exku8lyp0oq normalized_request={"session_id":"sess_1768023220073_exku8lyp0oq","query_len":4,"queryType":"product_keyword","queryTypes":["product_keyword"],"location_len":0,"limit":1}
[2026-01-10T05:33:40.076Z] [import-start] received_query_params {
[2026-01-10T05:33:40.076Z]   deadline_ms: null,
[2026-01-10T05:33:40.076Z]   stage_ms_primary: null,
[2026-01-10T05:33:40.076Z]   max_stage: null,
[2026-01-10T05:33:40.076Z]   skip_stages: null,
[2026-01-10T05:33:40.076Z]   dry_run: true
[2026-01-10T05:33:40.076Z] }
[2026-01-10T05:33:40.076Z] [import-start] normalized_effective_request {
[2026-01-10T05:33:40.076Z]   request_id: '959a42f6-0450-4d1b-903e-465e2c1d147d',
[2026-01-10T05:33:40.076Z]   session_id: 'sess_1768023220073_exku8lyp0oq',
[2026-01-10T05:33:40.076Z]   query: 'test',
[2026-01-10T05:33:40.076Z]   queryTypes: [ 'product_keyword' ],
[2026-01-10T05:33:40.076Z]   location: '',
[2026-01-10T05:33:40.076Z]   limit: 1,
[2026-01-10T05:33:40.077Z]   max_stage: null,
[2026-01-10T05:33:40.077Z]   skip_stages: [],
[2026-01-10T05:33:40.077Z]   dry_run: true,
[2026-01-10T05:33:40.077Z]   companies_seeded: 0
[2026-01-10T05:33:40.077Z] }
[2026-01-10T05:33:40.077Z] [import-start] request_id=959a42f6-0450-4d1b-903e-465e2c1d147d session=sess_1768023220073_exku8lyp0oq stage=validate_request extra={"queryTypes":["product_keyword"],"query_len":4,"limit":1}
[2026-01-10T05:33:40.077Z] {"handler_version":"ded-import-start-81014d4cf778","stage":"validate_request","queryTypes":["product_keyword"],"query_len":4,"prompt_len":0,"messages_len":0,"has_system_message":false,"has_user_message":false,"user_message_len":0,"elapsedMs":1,"upstream_status":null,"request_id":"959a42f6-0450-4d1b-903e-465e2c1d147d","session_id":"sess_1768023220073_exku8lyp0oq"}
[2026-01-10T05:33:40.077Z] [import-start] stage {
[2026-01-10T05:33:40.077Z]   stage: 'validate_request_done',
[2026-01-10T05:33:40.077Z]   request_id: '959a42f6-0450-4d1b-903e-465e2c1d147d',
[2026-01-10T05:33:40.077Z]   session_id: 'sess_1768023220073_exku8lyp0oq'
[2026-01-10T05:33:40.077Z] }
[2026-01-10T05:33:40.077Z] [import-start] request_id=959a42f6-0450-4d1b-903e-465e2c1d147d session=sess_1768023220073_exku8lyp0oq stage=dry_run
[2026-01-10T05:33:40.079Z] Executed 'Functions.import-start' (Succeeded, Id=a6eebca6-c63e-416e-b690-34d8a2ae38db, Duration=33ms)
[2026-01-10T05:33:40.309Z] Host lock lease acquired by instance ID '0000000000000000000000000B8DC44F'.
