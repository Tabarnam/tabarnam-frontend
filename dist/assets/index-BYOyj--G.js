import{j as e,r as i,R as j,k as we}from"./vendor-react-WIdRnkrd.js";import{i as Ne,t as Ce,j as Se,k as _e,X as Ie,u as Ee,H as $,L as ae,m as re,C as Re,n as Le,p as ke,q as Me,P as ee,v as Ae,w as De,x as Pe,y as Fe,B as Te,z as Oe,A as J}from"./vendor-other-CiZ3uhdK.js";import{T as Ue,t as O}from"./vendor-sonner-ddwK6uP6.js";import{S as ze,O as ne,P as qe,C as oe,a as Ve,T as ie,D as le,R as He,b as ce,I as Ke,c as Be,d as de,V as Je,L as ue,e as me,f as We,g as Xe,h as he,i as Ge}from"./vendor-radix-D-j7H0gH.js";import{u as te,f as W,g as se}from"./vendor-tanstack-BJAk8xLE.js";import{m as Qe}from"./vendor-framer-BS-GyOmh.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();const Ye=({...t})=>e.jsx(Ue,{theme:"system",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t}),$e="https://qiqfjqegxnrivayvliba.supabase.co",Ze="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFpcWZqcWVneG5yaXZheXZsaWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2MTY5MjMsImV4cCI6MjA2ODE5MjkyM30.-a4qe-VXr3qyz1Xz-wwueOL7CHd7M1HiC8fpB4Lejyc",I=Ne($e,Ze),pe=i.createContext(void 0),et=({children:t})=>{const[s,a]=i.useState(null),[c,r]=i.useState(!0);return i.useEffect(()=>{I.auth.getSession().then(({data:{session:u}})=>{a(u?.user??null),r(!1)});const{data:o}=I.auth.onAuthStateChange((u,x)=>{a(x?.user??null)});return()=>{o.subscription.unsubscribe()}},[]),e.jsx(pe.Provider,{value:{user:s,loading:c},children:t})},ge=i.createContext(void 0),Z=()=>{const t=j.useContext(pe);if(t===void 0)throw new Error("useSupabaseAuth must be used within a SupabaseAuthProvider");return t},tt=({children:t})=>{const{user:s,loading:a}=Z(),[c,r]=i.useState(null),[o,u]=i.useState(!0),x=i.useCallback(async v=>{if(!v){r(null),u(!1);return}try{u(!0);const{data:p,error:E,status:N}=await I.from("profiles").select("role").eq("id",v.id).single();if(E&&N!==406)throw E;r(p?p.role:"viewer")}catch(p){console.error("Error fetching user role:",p),r("viewer")}finally{u(!1)}},[]);i.useEffect(()=>{a||x(s)},[s,a,x]);const f=i.useMemo(()=>({userRole:c,loading:a||o}),[c,a,o]);return e.jsx(ge.Provider,{value:f,children:t})},xe=()=>{const t=j.useContext(ge);if(t===void 0)throw new Error("useUserRole must be used within a UserRoleProvider");return t};function S(...t){return Ce(Se(t))}const st=_e("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),A=j.forwardRef(({className:t,variant:s,size:a,asChild:c=!1,...r},o)=>{const u=c?ze:"button";return e.jsx(u,{className:S(st({variant:s,size:a,className:t})),ref:o,...r})});A.displayName="Button";const g=j.forwardRef(({className:t,type:s,onEnter:a,...c},r)=>e.jsx("input",{type:s,className:S("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,onKeyDown:o=>{o.key==="Enter"&&a&&a(o)},...c}));g.displayName="Input";const at=He,rt=qe,fe=j.forwardRef(({className:t,...s},a)=>e.jsx(ne,{ref:a,className:S("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));fe.displayName=ne.displayName;const be=j.forwardRef(({className:t,children:s,...a},c)=>e.jsxs(rt,{children:[e.jsx(fe,{}),e.jsxs(oe,{ref:c,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(Ve,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));be.displayName=oe.displayName;const ye=({className:t,...s})=>e.jsx("div",{className:S("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});ye.displayName="DialogHeader";const je=({className:t,...s})=>e.jsx("div",{className:S("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});je.displayName="DialogFooter";const ve=j.forwardRef(({className:t,...s},a)=>e.jsx(ie,{ref:a,className:S("text-lg font-semibold leading-none tracking-tight",t),...s}));ve.displayName=ie.displayName;const nt=j.forwardRef(({className:t,...s},a)=>e.jsx(le,{ref:a,className:S("text-sm text-muted-foreground",t),...s}));nt.displayName=le.displayName;const ot=1;let Y=0;function it(){return Y=(Y+1)%Number.MAX_VALUE,Y.toString()}const w={state:{toasts:[]},listeners:[],getState:()=>w.state,setState:t=>{typeof t=="function"?w.state=t(w.state):w.state={...w.state,...t},w.listeners.forEach(s=>s(w.state))},subscribe:t=>(w.listeners.push(t),()=>{w.listeners=w.listeners.filter(s=>s!==t)})},lt=({...t})=>{const s=it(),a=r=>w.setState(o=>({...o,toasts:o.toasts.map(u=>u.id===s?{...u,...r}:u)})),c=()=>w.setState(r=>({...r,toasts:r.toasts.filter(o=>o.id!==s)}));return w.setState(r=>({...r,toasts:[{...t,id:s,dismiss:c},...r.toasts].slice(0,ot)})),{id:s,dismiss:c,update:a}};function G(){const[t,s]=i.useState(w.getState());return i.useEffect(()=>w.subscribe(c=>{s(c)}),[]),i.useEffect(()=>{const a=[];return t.toasts.forEach(c=>{if(c.duration===1/0)return;const r=setTimeout(()=>{c.dismiss()},c.duration||1e4);a.push(r)}),()=>{a.forEach(c=>clearTimeout(c))}},[t.toasts]),{toast:lt,toasts:t.toasts}}const ct=({isOpen:t,onClose:s,company:a,onSuccess:c})=>{const{toast:r}=G(),{register:o,handleSubmit:u,reset:x}=Ee({defaultValues:a||{company_name:"",logo_url:"",tagline:"",website_url:"",amazon_store_url:"",notes:"",contact_email:"",contact_page_url:"",star_rating:0,star_explanation:"",reviews:"[]"}});j.useEffect(()=>{x(a)},[a,x]);const f=async v=>{try{const{error:p}=await I.from("companies").upsert(v);if(p)throw p;r({title:"Success",description:"Company saved."}),c(),s()}catch(p){r({variant:"destructive",title:"Error",description:p.message})}};return e.jsx(at,{open:t,onOpenChange:s,children:e.jsxs(be,{children:[e.jsx(ye,{children:e.jsx(ve,{children:a?"Edit Company":"Add Company"})}),e.jsxs("form",{onSubmit:u(f),className:"space-y-4",children:[e.jsx(g,{placeholder:"Company Name",...o("company_name")}),e.jsx(g,{placeholder:"Logo URL",...o("logo_url")}),e.jsx(g,{placeholder:"Tagline",...o("tagline")}),e.jsx(g,{placeholder:"Website URL",...o("website_url")}),e.jsx(g,{placeholder:"Amazon Store URL",...o("amazon_store_url")}),e.jsx(g,{placeholder:"Notes",...o("notes")}),e.jsx(g,{placeholder:"Contact Email",...o("contact_email")}),e.jsx(g,{placeholder:"Contact Page URL",...o("contact_page_url")}),e.jsx(g,{type:"number",step:"0.5",placeholder:"Star Rating",...o("star_rating")}),e.jsx(g,{placeholder:"Star Explanation",...o("star_explanation")}),e.jsx(g,{placeholder:"Reviews (JSON array)",...o("reviews")}),e.jsxs(je,{children:[e.jsx(A,{type:"submit",children:"Save"}),e.jsx(A,{variant:"outline",onClick:s,children:"Cancel"})]})]})]})})},dt=()=>{const{user:t}=Z(),{userRole:s}=xe(),[a,c]=i.useState([]),[r,o]=i.useState([]),[u,x]=i.useState(""),[f,v]=i.useState([]),[p,E]=i.useState(!0),[N,P]=i.useState(""),[q,V]=i.useState(0),[b,L]=i.useState({hq_weight:1,manufacturing_weight:1,review_threshold:4,min_reviews:3}),[D,H]=i.useState(null),[k,M]=i.useState(!1),F=t?.email==="jon@tabarnam.com";i.useEffect(()=>{T();const n=localStorage.getItem("lastImportCount");n&&V(parseInt(n))},[]),i.useEffect(()=>{const n=a.filter(h=>Object.values(h).some(z=>z&&z.toString().toLowerCase().includes(u.toLowerCase())));o(n)},[u,a]);const T=async()=>{E(!0);try{const{data:n,error:h}=await I.from("companies").select("*");if(h)throw h;c(n||[]),o(n||[]);const{data:z,error:B}=await I.from("profiles").select("id, email, role");if(B)throw B;v(z||[]);const{data:Q,error:K}=await I.from("star_config").select("*").single();if(K)throw K;Q&&L(Q)}catch(n){O.error("Fetch Error",n.message)}finally{E(!1)}},l=async()=>{if(!F){O.error("Permission Denied","Only jon@tabarnam.com can manage users.");return}if(!N){O.error("Invalid Email","Enter a valid email.");return}try{const{error:n}=await I.from("profiles").upsert({email:N,role:"admin"});if(n)throw n;O.success("Success","Admin added."),P(""),T()}catch(n){O.error("Error",n.message)}},C=async n=>{if(F)try{const{error:h}=await I.from("profiles").delete().eq("id",n);if(h)throw h;O.success("Success","User deleted."),T()}catch(h){O.error("Error",h.message)}},_=async()=>{try{await I.from("star_config").upsert(b);const{error:n}=await I.rpc("recalc_star_ratings");if(n)throw n;O.success("Success","Stars recalculated."),T()}catch(n){O.error("Error",n.message)}},d=n=>{H(n),M(!0)},m=j.useMemo(()=>[{accessorKey:"company_name",header:"Name"},{accessorKey:"star_rating",header:"Star Rating"},{accessorKey:"headquarters_location",header:"HQ"},{accessorKey:"manufacturing_locations",header:"Manufacturing"},{id:"actions",header:"Actions",cell:({row:n})=>e.jsx(A,{onClick:()=>d(n.original),className:"bg-blue-600",children:"Edit"})}],[]),R=j.useMemo(()=>[{accessorKey:"email",header:"Email"},{accessorKey:"role",header:"Role"},{id:"actions",header:"Actions",cell:({row:n})=>e.jsx(A,{onClick:()=>C(n.original.id),disabled:!F,children:"Delete"})}],[]),y=te({data:f,columns:R,getCoreRowModel:se()}),U=te({data:r,columns:m,getCoreRowModel:se()});return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx("title",{children:"Admin Panel - Tabarnam"})}),e.jsxs("div",{className:"p-6 space-y-6",style:{backgroundColor:"rgb(177, 221, 227)"},children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Panel"}),e.jsxs("div",{className:"p-4 border",style:{borderColor:"rgb(100, 150, 180)"},children:["Last Import Count: ",q]}),e.jsxs("div",{className:"p-4 border",style:{borderColor:"rgb(100, 150, 180)"},children:[e.jsx("h2",{className:"text-xl",children:"User Management"}),e.jsx(g,{value:N,onChange:n=>P(n.target.value),placeholder:"Email"}),e.jsx(A,{onClick:l,disabled:!F,children:"Add Admin"}),e.jsxs("table",{className:"w-full border-collapse table-auto",children:[e.jsx("thead",{children:y.getHeaderGroups().map(n=>e.jsx("tr",{children:n.headers.map(h=>e.jsx("th",{className:"p-2 border",children:W(h.column.columnDef.header,h.getContext())},h.id))},n.id))}),e.jsx("tbody",{children:y.getRowModel().rows.map(n=>e.jsx("tr",{children:n.getVisibleCells().map(h=>e.jsx("td",{className:"p-2 border",children:W(h.column.columnDef.cell,h.getContext())},h.id))},n.id))})]})]}),p?e.jsx(ae,{className:"animate-spin"}):e.jsxs("div",{className:"p-4 border",style:{borderColor:"rgb(100, 150, 180)"},children:[e.jsx("h2",{className:"text-xl",children:"Companies"}),e.jsx(g,{placeholder:"Search companies by any field...",value:u,onChange:n=>x(n.target.value)}),e.jsxs("table",{className:"w-full border-collapse table-auto",children:[e.jsx("thead",{children:U.getHeaderGroups().map(n=>e.jsx("tr",{children:n.headers.map(h=>e.jsx("th",{className:"p-2 border",children:W(h.column.columnDef.header,h.getContext())},h.id))},n.id))}),e.jsx("tbody",{children:U.getRowModel().rows.map(n=>e.jsx("tr",{children:n.getVisibleCells().map(h=>e.jsx("td",{className:"p-2 border",children:W(h.column.columnDef.cell,h.getContext())},h.id))},n.id))})]})]}),e.jsxs("div",{className:"p-4 border",style:{borderColor:"rgb(100, 150, 180)"},children:[e.jsx("h2",{className:"text-xl",children:"Star Rating Config"}),e.jsx(g,{type:"number",value:b.hq_weight,onChange:n=>L({...b,hq_weight:parseFloat(n.target.value)}),placeholder:"HQ Weight"}),e.jsx(g,{type:"number",value:b.manufacturing_weight,onChange:n=>L({...b,manufacturing_weight:parseFloat(n.target.value)}),placeholder:"Manufacturing Weight"}),e.jsx(g,{type:"number",value:b.review_threshold,onChange:n=>L({...b,review_threshold:parseFloat(n.target.value)}),placeholder:"Review Threshold"}),e.jsx(g,{type:"number",value:b.min_reviews,onChange:n=>L({...b,min_reviews:parseInt(n.target.value)}),placeholder:"Min Reviews"}),e.jsx(A,{onClick:_,children:"Recalculate Stars"})]}),k&&e.jsx(ct,{isOpen:k,onClose:()=>M(!1),company:D,onSuccess:T}),e.jsx(re,{to:"/admin/xai-bulk-import",children:"Bulk Import Tool"})]})]})},X=Ge,ut=j.forwardRef(({className:t,children:s,...a},c)=>e.jsxs(ce,{ref:c,className:S("flex h-10 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:[s,e.jsx(Ke,{asChild:!0,children:e.jsx(Re,{className:"h-4 w-4 opacity-50"})})]}));ut.displayName=ce.displayName;const mt=j.forwardRef(({className:t,children:s,position:a="popper",...c},r)=>e.jsx(Be,{children:e.jsx(de,{ref:r,className:S("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...c,children:e.jsx(Je,{className:S("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s})})}));mt.displayName=de.displayName;const ht=j.forwardRef(({className:t,...s},a)=>e.jsx(ue,{ref:a,className:S("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));ht.displayName=ue.displayName;const pt=j.forwardRef(({className:t,children:s,...a},c)=>e.jsxs(me,{ref:c,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(We,{children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsx(Xe,{children:s})]}));pt.displayName=me.displayName;const gt=j.forwardRef(({className:t,...s},a)=>e.jsx(he,{ref:a,className:S("-mx-1 my-1 h-px bg-muted",t),...s}));gt.displayName=he.displayName;const xt=()=>{const t=ke.useSupabaseClient(),{toast:s}=G(),[a,c]=i.useState([]),[r,o]=i.useState(!1),[u,x]=i.useState(""),[f,v]=i.useState(""),[p,E]=i.useState(""),[N,P]=i.useState(""),[q,V]=i.useState("Nearest Manufacturing"),[b,L]=i.useState([]),[D,H]=i.useState("en"),[k,M]=i.useState(null);i.useEffect(()=>{navigator.geolocation.getCurrentPosition(d=>M({lat:d.coords.latitude,long:d.coords.longitude}),()=>s({variant:"destructive",title:"Location Error",description:"Unable to get location."}))},[]);const F=async()=>{o(!0);try{let{data:d,error:m}=await t.from("companies").select("*").ilike("company_name",`%${u}%`);if(m)throw m;c(d||[]),d.length<20}catch(d){s({variant:"destructive",title:"Search Error",description:d.message})}finally{o(!1)}},T=async()=>{o(!0);try{const d=`Deep search ${u}, find more with reviews/Amazon, prioritizing search terms, location preference, smaller businesses.`,m=await callXAI(d);await t.from("companies").upsert(m),F()}catch(d){s({variant:"destructive",title:"Dig Deep Error",description:d.message})}finally{o(!1)}},l=(d,m,R,y,U)=>{const h=(R-d)*Math.PI/180,z=(y-m)*Math.PI/180,B=Math.sin(h/2)*Math.sin(h/2)+Math.cos(d*Math.PI/180)*Math.cos(R*Math.PI/180)*Math.sin(z/2)*Math.sin(z/2);let K=6371*(2*Math.atan2(Math.sqrt(B),Math.sqrt(1-B)));return["United States","United Kingdom","Liberia","Antigua and Barbuda","Bahamas","Barbados","Belize","British Virgin Islands","Cayman Islands","Dominica","Falkland Islands","Grenada","Guam","Montserrat","Northern Mariana Islands","Saint Kitts and Nevis","Saint Lucia","Saint Vincent and the Grenadines","Samoa","Turks and Caicos Islands","United States Virgin Islands","Anguilla","Gibraltar","Isle of Man","Jersey","Guernsey","Saint Helena/Ascension/Tristan da Cunha","American Samoa","Puerto Rico"].includes(U)?(K*=.621371,`${K.toFixed(2)} mi`):`${K.toFixed(2)} km`},C=[{Header:"Company",accessor:"company_name",Cell:({row:d})=>{const m=d.original,R=b.includes(d.id);return e.jsxs("div",{onClick:()=>_(d.id),className:"cursor-pointer",children:[m.company_name,R&&e.jsxs("div",{children:[m.tagline,e.jsx("a",{href:m.website_url,target:"_blank",rel:"noopener noreferrer",children:m.website_url})," (copy icon)",m.amazon_store_url&&e.jsx("a",{href:m.amazon_store_url+"?tag=tabarnam-20",target:"_blank",rel:"noopener noreferrer",children:"Amazon Store"})," (hover toast full URL) Keywords: ",m.company_keywords.join(", ")," (truncate, hover expand, clickable) Industries: ",m.industry_keywords.join(", ")]})]})}},{Header:()=>e.jsxs("div",{children:[e.jsx(ee,{className:"inline mr-1"})," Home/HQ"]}),accessor:"headquarters",Cell:({row:d})=>{const m=d.original,R=b.includes(d.id),y=m.headquarters_locations||[];return e.jsxs("div",{children:[y[0]?.city," (distance: ",k&&l(k.lat,k.long,y[0].lat,y[0].long,y[0].country),")",R&&y.slice(1).map((U,n)=>e.jsxs("div",{children:[U.city," (distance)"]},n)),y.length>2&&e.jsx("span",{children:"More..."})]})}},{Header:()=>e.jsxs("div",{children:[e.jsx(ee,{className:"inline mr-1"})," Manufacturing"]}),accessor:"manufacturing_locations",Cell:({row:d})=>{const m=d.original,R=b.includes(d.id),y=m.manufacturing_locations||[];return e.jsxs("div",{children:[y[0]?.city," (distance: ",k&&l(k.lat,k.long,y[0].lat,y[0].long,y[0].country),")",R&&y.slice(1).map((U,n)=>e.jsxs("div",{children:[U.city," (distance)"]},n)),y.length>2&&e.jsx("span",{children:"More..."})]})}},{Header:"Stars",accessor:"star_rating",Cell:({row:d})=>{const m=d.original;return m.star_rating<4?e.jsx("div",{onMouseOver:()=>s(m.star_explanation),children:"Hover for explanation"}):e.jsxs("div",{children:[m.star_rating," stars (hover: ",m.star_explanation,")"]})}}],_=d=>{L(m=>m.includes(d)?m.filter(R=>R!==d):[...m,d])};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(g,{placeholder:"Search",value:u,onChange:d=>x(d.target.value)}),e.jsx(X,{value:f,onChange:v})," ",e.jsx(X,{value:p,onChange:E}),e.jsx(g,{placeholder:"City/Postal",value:N,onChange:P}),e.jsx(X,{value:q,onChange:V,defaultValue:"Nearest Manufacturing"}),e.jsx(A,{onClick:F,children:"Search"})]}),e.jsx(X,{value:D,onChange:H})," ",r?e.jsx("div",{children:"Loading..."}):e.jsx(Me,{data:a,columns:C,defaultPageSize:10,className:"border"}),a.length<20&&e.jsx(A,{onClick:T,children:"Dig Deep (hover: Refine your search...)"})]})};function ft(){return e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx("title",{children:"Tabarnam – Discover Verified Companies"}),e.jsx("meta",{name:"description",content:"Explore verified companies by location, product, and more with Tabarnam."})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Welcome to Tabarnam"}),e.jsx("p",{className:"text-lg",children:"Search and explore thousands of verified companies around the world."}),e.jsx(re,{to:"/results",className:"inline-block mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700",children:"Get Started"})]})]})}console.log("Deploy test");function bt(){const[t,s]=i.useState(1),[a,c]=i.useState("product_keywords"),[r,o]=i.useState(""),[u,x]=i.useState(""),[f,v]=i.useState([]),[p,E]=i.useState(""),[N,P]=i.useState(1),[q,V]=i.useState(null),[b,L]=i.useState(!1),D=20;i.useEffect(()=>{sessionStorage.getItem("keyLogged")||(console.log("ENV CHECK (once on mount):",{VITE_FUNCTION_KEY:void 0}),sessionStorage.setItem("keyLogged","true"))},[]),i.useEffect(()=>{b&&r.trim()&&(async()=>{x("Importing..."),v([]),P(1);{x("❌ Missing VITE_FUNCTION_KEY. Set it in your environment variables."),L(!1);return}})()},[b,r,a,t]);const H=()=>{if(!r.trim()){x("❌ Enter a search value.");return}L(!0)},k=()=>{v([]),x(""),o(""),s(1),P(1),V(null),L(!1),sessionStorage.removeItem("keyLogged")},M=f.filter(l=>{const C=l.company_name?.toLowerCase().includes(p.toLowerCase()),_=l.industries?.some(d=>d.toLowerCase().includes(p.toLowerCase()));return C||_}),F=M.slice((N-1)*D,N*D),T=[{value:"company_name",label:"Company Name"},{value:"product_keywords",label:"Product Keywords"},{value:"industries",label:"Industry"},{value:"headquarters_location",label:"Headquarters Location"},{value:"manufacturing_locations",label:"Manufacturing Location"},{value:"email_address",label:"Email Address"},{value:"url",label:"Website URL"},{value:"amazon_url",label:"Amazon URL"}];return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Bulk Company Import"}),e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxImports",className:"block text-sm font-medium text-gray-700",children:"Number of Companies (1-20)"}),e.jsx("input",{id:"maxImports",type:"number",min:"1",max:"20",value:t,onChange:l=>s(Number(l.target.value)),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"searchField",className:"block text-sm font-medium text-gray-700",children:"Search Field"}),e.jsx("select",{id:"searchField",value:a,onChange:l=>c(l.target.value),className:"w-full border rounded px-3 py-2",children:T.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"searchValue",className:"block text-sm font-medium text-gray-700",children:"Search Value"}),e.jsx("input",{id:"searchValue",type:"text",value:r,onChange:l=>o(l.target.value),onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),H())},className:"w-full border rounded px-3 py-2"})]})]}),e.jsx("button",{onClick:H,className:"bg-blue-600 text-white rounded px-4 py-2 mb-4",disabled:b,children:b?"Importing...":"Start Import"}),u&&e.jsx("p",{className:"mb-3",children:u}),f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Filter by name or industry...",value:p,onChange:l=>E(l.target.value),className:"w-full border rounded px-3 py-2 mb-3"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(JSON.stringify(M,null,2)),className:"bg-green-600 text-white rounded px-3 py-2",children:"Copy All"}),e.jsx("button",{onClick:()=>{const l=new Blob([JSON.stringify(M,null,2)],{type:"text/json"}),C=window.URL.createObjectURL(l),_=document.createElement("a");_.href=C,_.download="companies.json",_.click(),window.URL.revokeObjectURL(C)},className:"bg-yellow-600 text-white rounded px-3 py-2",children:"Export JSON"}),e.jsx("button",{onClick:k,className:"bg-red-600 text-white rounded px-3 py-2",children:"Clear List"})]}),e.jsx("ul",{className:"space-y-2",children:F.map((l,C)=>e.jsxs("li",{className:"border rounded p-3 cursor-pointer",onClick:()=>V(q===C?null:C),children:[e.jsxs("strong",{children:[(N-1)*D+C+1,". ",l.company_name]})," ","— ",l.industries?.join(", ")||"N/A",q===C&&e.jsxs("div",{className:"mt-2 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tagline:"})," ",l.company_tagline]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",l.email_address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Website:"})," ",e.jsx("a",{href:l.url,target:"_blank",rel:"noreferrer",children:l.url})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Keywords:"})," ",l.product_keywords]}),e.jsxs("p",{children:[e.jsx("strong",{children:"HQ:"})," ",l.headquarters_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Manufacturing:"})," ",l.manufacturing_locations?.join(", ")||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Red Flag:"})," ",l.red_flag?"🚩 Yes":"No"]}),l.amazon_url&&e.jsxs("p",{children:[e.jsx("strong",{children:"Amazon:"})," ",e.jsx("a",{href:l.amazon_url,target:"_blank",rel:"noreferrer",children:l.amazon_url})]}),Array.isArray(l.reviews)&&l.reviews.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Reviews:"}),e.jsx("ul",{className:"list-disc list-inside",children:l.reviews.map((_,d)=>e.jsx("li",{children:e.jsxs("a",{href:_.link,target:"_blank",rel:"noreferrer",children:["[",_.source||"Review","] ",_.text]})},d))})]})]})]},C))}),M.length>D&&e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{disabled:N===1,onClick:()=>P(l=>l-1),className:"px-3 py-1 border rounded",children:"Prev"}),e.jsx("button",{disabled:N*D>=M.length,onClick:()=>P(l=>l+1),className:"px-3 py-1 border rounded",children:"Next"}),e.jsxs("span",{className:"text-sm pt-2",children:["Page ",N," of ",Math.ceil(M.length/D)]})]})]})]})}function yt(){const[t,s]=i.useState(""),[a,c]=i.useState(""),[r,o]=i.useState(!1),{toast:u}=G(),x=Ae(),f=async p=>{p.preventDefault(),o(!0);const{error:E}=await I.auth.signInWithPassword({email:t,password:a});o(!1),E?u({title:"Login Failed",description:E.message,variant:"destructive"}):x("/admin")},v=p=>{p.key==="Enter"&&f(p)};return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx("title",{children:"Login - Tabarnam Admin"})}),e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center px-4",children:e.jsxs("form",{onSubmit:f,className:"bg-slate-800 p-6 rounded-lg shadow-lg w-full max-w-sm space-y-5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"w-8 h-8 text-white mx-auto mb-1"}),e.jsx("h2",{className:"text-white text-xl font-semibold",children:"Admin Login"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Email"}),e.jsx(g,{type:"email",placeholder:"you@example.com",value:t,onChange:p=>s(p.target.value),required:!0,className:"bg-slate-700 text-white",onKeyDown:v})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Password"}),e.jsx(g,{type:"password",placeholder:"••••••••",value:a,onChange:p=>c(p.target.value),required:!0,className:"bg-slate-700 text-white",onKeyDown:v})]}),e.jsxs(A,{type:"submit",className:"w-full",disabled:r,children:[r?e.jsx(ae,{className:"animate-spin w-5 h-5 mr-2"}):e.jsx(Pe,{className:"w-5 h-5 mr-2"}),r?"Logging in...":"Log In"]})]})})]})}const jt=()=>{const[t,s]=i.useState(""),[a,c]=i.useState(""),[r,o]=i.useState(!1),{toast:u}=G(),x=async f=>{f&&f.preventDefault(),o(!0);const{error:v}=await I.auth.signInWithPassword({email:t,password:a});u(v?{variant:"destructive",title:"Error",description:v.message}:{title:"Success!",description:"Successfully signed in."}),o(!1)};return e.jsxs(Qe.form,{onSubmit:x,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md mx-auto bg-white/10 backdrop-blur-lg p-8 rounded-2xl border border-white/20",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-white mb-6",children:"Access Dashboard"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:t,onChange:f=>s(f.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-white/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"you@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:a,onChange:f=>c(f.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-white/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"••••••••"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsx(A,{type:"submit",disabled:r,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-8 py-3 rounded-xl text-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300",children:r?"Signing In...":"Sign In"})})]})]})};function vt({children:t}){const{user:s,loading:a}=Z(),{userRole:c,loading:r}=xe();return a||r?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-900",children:e.jsx("img",{src:"/tabarnam-icon.png",alt:"Loading",className:"w-12 h-12 animate-spin"})}):s?c!=="admin"?e.jsx("div",{className:"min-h-screen bg-slate-900 p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:"You do not have permission to view this page."}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"If you believe this is an error, please contact support."})]})}):t:e.jsx("div",{className:"min-h-screen bg-slate-900 p-6 flex items-center justify-center",children:e.jsx(jt,{})})}class wt extends j.Component{state={hasError:!1};static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsx("h1",{children:"Something went wrong. Please try again later."}):this.props.children}}function Nt(){return e.jsx(Fe,{children:e.jsx(et,{children:e.jsx(tt,{children:e.jsxs(wt,{children:[e.jsx(Te,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx("div",{className:"min-h-screen",children:e.jsxs(Oe,{children:[e.jsx(J,{path:"/",element:e.jsx(ft,{})}),e.jsx(J,{path:"/results",element:e.jsx(xt,{})}),e.jsx(J,{path:"/login",element:e.jsx(yt,{})}),e.jsx(J,{path:"/admin",element:e.jsx(vt,{children:e.jsx(dt,{})})}),e.jsx(J,{path:"/admin/xai-bulk-import",element:e.jsx(bt,{})})]})})}),e.jsx(Ye,{})]})})})})}we.createRoot(document.getElementById("root")).render(e.jsx(j.StrictMode,{children:e.jsx(Nt,{})}));
